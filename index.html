<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cry vs Shout: The Weekly Run</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-100 to-red-100 min-h-screen flex flex-col items-center justify-center p-4">
  <div class="text-center mb-6">
    <img src="cry_icon.png" alt="Logo" class="mx-auto w-16 h-16 mb-2">
    <h1 class="text-2xl font-bold">Cry vs Shout: The Weekly Run</h1>
  </div>

  <!-- Login Form -->
  <div id="login-section" class="w-full max-w-sm mx-auto">
    <div class="bg-white p-6 rounded-xl shadow-md">
      <input id="email" type="email" placeholder="Email" class="w-full mb-4 p-2 border rounded" />
      <input id="password" type="password" placeholder="Password" class="w-full mb-4 p-2 border rounded" />
      <button onclick="login()" class="w-full bg-blue-500 hover:bg-blue-600 text-white p-2 rounded">Log In</button>
      <p id="login-error" class="text-red-500 text-sm mt-2 hidden"></p>
    </div>
  </div>

  <!-- Tracker Page -->
  <div id="tracker-section" class="hidden w-full max-w-md mx-auto">
    <div class="bg-white p-4 rounded-xl shadow-md">
      <div class="flex justify-between mb-4">
        <div class="flex items-center space-x-2">
          <img src="cry_icon.png" class="w-6 h-6" alt="Cry">
          <p class="font-bold">Cries: <span id="cry-count">0</span></p>
        </div>
        <div class="flex items-center space-x-2">
          <img src="shout_icon.png" class="w-6 h-6" alt="Shout">
          <p class="font-bold">Shouts: <span id="shout-count">0</span></p>
        </div>
      </div>
      <div class="grid grid-cols-7 gap-2 mb-4" id="day-tracker">
        <!-- Days (auto-generated) -->
      </div>
      <div class="flex justify-between">
        <button onclick="addEvent('cry')" class="bg-blue-400 hover:bg-blue-600 text-white rounded p-2 w-1/2 mr-2">Add Cry</button>
        <button onclick="addEvent('shout')" class="bg-red-400 hover:bg-red-600 text-white rounded p-2 w-1/2 ml-2">Add Shout</button>
      </div>
    </div>
  </div>

  <script>
    const SUPABASE_URL = "https://bbeummehrwczxuwufejk.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJiZXVtbWVocndjenh1d3VmZWprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxNDQzNjcsImV4cCI6MjA2OTcyMDM2N30.MOcvwbf1R4ZqPi83WJHKvBLYFpb0k42cmRGdYWkOeh8";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        document.getElementById('login-error').innerText = error.message;
        document.getElementById('login-error').classList.remove('hidden');
      } else {
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('tracker-section').classList.remove('hidden');
        loadWeeklyCounts();
        renderDays();
      }
    }

    async function addEvent(type) {
      const date = new Date().toISOString();
      const user = (await supabase.auth.getUser()).data.user;
      await supabase.from('events').insert([{ user_id: user.id, type, created_at: date }]);
      loadWeeklyCounts();
    }

    async function loadWeeklyCounts() {
      const startOfWeek = new Date();
      startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
      const start = startOfWeek.toISOString();

      const user = (await supabase.auth.getUser()).data.user;

      let { data: cries } = await supabase.from('events').select('*', { count: 'exact' }).eq('type', 'cry').gte('created_at', start).eq('user_id', user.id);
      let { data: shouts } = await supabase.from('events').select('*', { count: 'exact' }).eq('type', 'shout').gte('created_at', start).eq('user_id', user.id);

      document.getElementById('cry-count').innerText = cries.length;
      document.getElementById('shout-count').innerText = shouts.length;
    }

    function renderDays() {
      const tracker = document.getElementById('day-tracker');
      tracker.innerHTML = '';
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      days.forEach(day => {
        const div = document.createElement('div');
        div.className = 'text-center bg-gray-100 rounded p-1 text-sm';
        div.innerText = day;
        tracker.appendChild(div);
      });
    }
  </script>
</body>
</html>
